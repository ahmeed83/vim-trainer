@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap');

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  *, *::before, *::after {
    @apply m-0 p-0 box-border;
  }

  html, body {
    @apply h-full font-sans bg-primary text-text-primary leading-normal;
  }
}

@layer components {
  .app {
    @apply flex flex-col h-screen overflow-hidden;
  }

  /* Header */
  .header {
    @apply flex items-center justify-between px-6 py-3 bg-secondary border-b border-border;
  }

  .logo {
    @apply flex items-center gap-3;
  }

  .logo-icon {
    @apply text-2xl;
  }

  .logo h1 {
    @apply text-xl font-semibold bg-gradient-to-br from-accent-green to-accent-cyan bg-clip-text text-transparent;
  }

  .nav {
    @apply flex gap-2;
  }

  .nav-btn {
    @apply px-4 py-2 bg-transparent border border-transparent rounded-lg text-text-secondary font-sans text-sm font-medium cursor-pointer transition-all duration-200;
  }

  .nav-btn:hover {
    @apply bg-tertiary text-text-primary;
  }

  .nav-btn.active {
    @apply bg-tertiary border-border text-text-primary;
  }

  /* Main Content */
  .main {
    @apply flex-1 overflow-hidden;
  }

  .view {
    @apply hidden h-full;
  }

  .view.active {
    @apply flex;
  }

  /* Sidebar */
  .sidebar {
    @apply w-[280px] bg-secondary border-r border-border flex flex-col overflow-hidden;
  }

  .sidebar h2 {
    @apply px-5 py-4 text-sm font-semibold uppercase tracking-wider text-text-secondary border-b border-border;
  }

  .lesson-list {
    @apply flex-1 overflow-y-auto p-2;
  }

  .lesson-item {
    @apply flex items-center gap-3 px-4 py-3 mb-1 rounded-lg cursor-pointer transition-all duration-200;
  }

  .lesson-item:hover {
    @apply bg-tertiary;
  }

  .lesson-item.active {
    @apply bg-tertiary border-l-[3px] border-l-accent-blue;
  }

  .lesson-item.completed {
    @apply opacity-70;
  }

  .lesson-item.locked {
    @apply opacity-50 cursor-pointer;
  }

  .lesson-item.locked:hover {
    @apply opacity-70;
  }

  .lesson-icon {
    @apply w-8 h-8 flex items-center justify-center bg-tertiary rounded text-sm;
  }

  .lesson-item.completed .lesson-icon {
    @apply bg-accent-green text-primary;
  }

  .lesson-item.locked .lesson-icon {
    @apply bg-hover;
  }

  .lesson-info {
    @apply flex-1 min-w-0;
  }

  .lesson-name {
    @apply text-sm font-medium text-text-primary whitespace-nowrap overflow-hidden text-ellipsis;
  }

  .lesson-keys {
    @apply text-xs text-text-muted font-mono;
  }

  /* Progress Section */
  .progress-section {
    @apply px-5 py-4 border-t border-border;
  }

  .progress-section h3 {
    @apply text-xs font-semibold uppercase tracking-wider text-text-secondary mb-3;
  }

  .progress-bar {
    @apply h-2 bg-tertiary rounded overflow-hidden mb-2;
  }

  .progress-fill {
    @apply h-full bg-gradient-to-r from-accent-green to-accent-cyan rounded transition-all duration-300;
  }

  .progress-text {
    @apply text-xs text-text-muted;
  }

  /* Lesson Content */
  .lesson-content {
    @apply flex-1 flex flex-col p-6 overflow-hidden;
  }

  .lesson-header {
    @apply mb-5;
  }

  .lesson-header h2 {
    @apply text-2xl font-semibold mb-2;
  }

  .lesson-header p {
    @apply text-text-secondary;
  }

  /* Editor */
  .editor-container {
    @apply flex-1 flex flex-col bg-primary border border-border rounded-xl overflow-hidden shadow-lg;
  }

  .editor-toolbar {
    @apply flex items-center gap-4 px-4 py-3 bg-secondary border-b border-border;
  }

  .mode-indicator {
    @apply px-3 py-1 bg-accent-green text-primary font-mono text-xs font-bold rounded uppercase;
  }

  .mode-indicator.insert {
    @apply bg-accent-blue;
  }

  .mode-indicator.visual {
    @apply bg-accent-purple;
  }

  .mode-indicator.command {
    @apply bg-accent-orange;
  }

  .command-display {
    @apply flex-1 font-mono text-sm text-accent-cyan min-h-[1.25rem];
  }

  .key-hint {
    @apply text-xs text-text-muted font-mono;
  }

  .editor-wrapper {
    @apply flex-1 flex overflow-hidden;
  }

  .line-numbers {
    @apply py-4 px-2 bg-secondary border-r border-border font-mono text-sm text-text-muted text-right select-none min-w-[3rem];
  }

  .line-number {
    @apply px-2 h-6 leading-6;
  }

  .line-number.active {
    @apply text-text-primary;
  }

  .editor {
    @apply flex-1 p-4 font-mono text-sm leading-6 outline-none overflow-auto whitespace-pre cursor-text;
  }

  .editor:focus {
    @apply outline-none;
  }

  .editor-line {
    @apply h-6 relative;
  }

  .editor-line.current {
    @apply bg-white/[0.03];
  }

  .char {
    @apply inline-block relative;
  }

  .char.cursor-on {
    @apply bg-accent-blue text-primary;
  }

  .char.selected {
    @apply bg-accent-blue/30;
  }

  .cursor {
    @apply absolute w-[0.55em] h-5 bg-accent-blue animate-blink;
  }

  .cursor.insert {
    @apply w-0.5;
  }

  .status-bar {
    @apply flex items-center justify-between px-4 py-2 bg-secondary border-t border-border font-mono text-xs text-text-muted;
  }

  /* Task Panel */
  .task-panel {
    @apply mt-5 p-5 bg-secondary border border-border rounded-xl;
  }

  .task-panel h3 {
    @apply text-sm font-semibold text-text-secondary mb-3;
  }

  #task-instruction {
    @apply text-base leading-relaxed mb-4;
  }

  .task-progress {
    @apply flex items-center justify-between;
  }

  #task-step {
    @apply text-sm text-text-muted;
  }

  .btn-hint {
    @apply px-4 py-2 bg-tertiary border border-border rounded-lg text-text-secondary font-sans text-sm cursor-pointer transition-all duration-200;
  }

  .btn-hint:hover {
    @apply bg-hover text-text-primary;
  }

  /* Sandbox View */
  .sandbox-view {
    @apply justify-center items-center p-8;
  }

  .sandbox-container {
    @apply w-full max-w-[900px] h-full flex flex-col;
  }

  .sandbox-header {
    @apply mb-6 text-center;
  }

  .sandbox-header h2 {
    @apply text-2xl mb-2;
  }

  .sandbox-header p {
    @apply text-text-secondary;
  }

  /* Reference View */
  .reference-view {
    @apply overflow-y-auto p-8;
  }

  .reference-container {
    @apply max-w-[1200px] mx-auto;
  }

  .reference-container h2 {
    @apply text-2xl mb-6 text-center;
  }

  .reference-grid {
    @apply grid grid-cols-[repeat(auto-fill,minmax(350px,1fr))] gap-6;
  }

  .reference-card {
    @apply bg-secondary border border-border rounded-xl p-5;
  }

  .reference-card h3 {
    @apply text-base font-semibold mb-4 text-accent-cyan flex items-center gap-2;
  }

  .reference-card h3::before {
    content: '';
    @apply w-1 h-4 bg-accent-cyan rounded;
  }

  .reference-list {
    @apply flex flex-col gap-2;
  }

  .reference-item {
    @apply flex items-center gap-4 p-2 rounded;
  }

  .reference-item:hover {
    @apply bg-tertiary;
  }

  .ref-key {
    @apply font-mono text-sm font-semibold text-accent-green bg-tertiary px-2 py-1 rounded min-w-[60px] text-center;
  }

  .ref-desc {
    @apply text-sm text-text-secondary;
  }

  /* Modal */
  .modal {
    @apply hidden fixed inset-0 bg-black/70 backdrop-blur justify-center items-center z-50;
  }

  .modal.active {
    @apply flex;
  }

  .modal-content {
    @apply bg-secondary border border-border rounded-xl p-10 text-center max-w-[400px] shadow-2xl animate-modal-in;
  }

  .modal-icon {
    @apply text-5xl mb-4;
  }

  .modal-content h2 {
    @apply text-2xl mb-3;
  }

  .modal-content p {
    @apply text-text-secondary mb-6;
  }

  .btn-primary {
    @apply px-8 py-3 bg-gradient-to-br from-accent-green to-accent-cyan border-none rounded-lg text-primary font-sans text-base font-semibold cursor-pointer transition-all duration-200;
  }

  .btn-primary:hover {
    @apply -translate-y-0.5 shadow-lg shadow-accent-green/30;
  }

  /* Premium Modal */
  .premium-modal-content {
    @apply max-w-[420px];
  }

  .premium-features {
    @apply list-none text-left my-6;
  }

  .premium-features li {
    @apply py-2 text-text-secondary;
  }

  .premium-price {
    @apply flex flex-col items-center my-6;
  }

  .price {
    @apply text-4xl font-bold bg-gradient-to-br from-accent-green to-accent-cyan bg-clip-text text-transparent;
  }

  .price-note {
    @apply text-sm text-text-muted mt-1;
  }

  .btn-checkout {
    @apply w-full p-4 text-base mb-3;
  }

  .btn-secondary {
    @apply w-full px-6 py-3 bg-transparent border border-border rounded-lg text-text-secondary font-sans text-sm cursor-pointer transition-all duration-200;
  }

  .btn-secondary:hover {
    @apply bg-tertiary text-text-primary;
  }

  /* Keyboard Key Style */
  kbd {
    @apply inline-block px-2 py-0.5 font-mono text-sm bg-tertiary border border-border rounded shadow-sm;
  }

  /* Highlight animation */
  .highlight-success {
    animation: highlightSuccess 0.5s ease;
  }
}

@layer utilities {
  .animate-blink {
    animation: blink 1s step-end infinite;
  }

  .animate-modal-in {
    animation: modalIn 0.3s ease;
  }
}

@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0; }
}

@keyframes modalIn {
  from {
    opacity: 0;
    transform: scale(0.9) translateY(-20px);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

@keyframes highlightSuccess {
  0%, 100% { background: transparent; }
  50% { background: rgba(63, 185, 80, 0.2); }
}

/* Scrollbar */
::-webkit-scrollbar {
  @apply w-2 h-2;
}

::-webkit-scrollbar-track {
  @apply bg-primary;
}

::-webkit-scrollbar-thumb {
  @apply bg-tertiary rounded;
}

::-webkit-scrollbar-thumb:hover {
  @apply bg-hover;
}

/* Responsive */
@media (max-width: 768px) {
  .header {
    @apply px-4 py-2;
  }

  .sidebar {
    @apply w-[220px];
  }

  .lesson-content {
    @apply p-4;
  }

  .reference-grid {
    @apply grid-cols-1;
  }
}
